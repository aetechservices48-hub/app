<!DOCTYPE html>
<html>
<head>
  <title>ID Photo Generator</title>
  <style>
    .preview {
      border: 2px solid black;
      position: relative;
      margin-top: 10px;
      background: #f9f9f9;
      overflow: hidden;
    }
    .face {
      background: #ccc;
      border-radius: 50%;
      position: absolute;
      border: 2px solid black;
    }
    .grid-line {
      position: absolute;
      background: rgba(0,0,0,0.2);
      pointer-events: none;
    }
    .grid-line.h { height:1px; width:100%; left:0; }
    .grid-line.v { width:1px; height:100%; top:0; }
  </style>
</head>
<body>
  <h1>ID Photo Generator</h1>

  <form id="uploadForm" enctype="multipart/form-data">
    <label>Upload Images:</label>
    <input type="file" name="images" multiple><br><br>

    <label>Background Color:</label>
    <input type="color" name="bg_color" value="#ffffff"><br><br>

    <label>Width (inches):</label>
    <input type="number" id="width_in" name="width_in" step="0.01" value="1.77"><br><br>

    <label>Height (inches):</label>
    <input type="number" id="height_in" name="height_in" step="0.01" value="1.50"><br><br>

    <label>Face Ratio:</label>
    <input type="range" id="face_ratio" name="face_ratio" min="0.3" max="0.9" step="0.01" value="0.6"><br><br>

    <label>Vertical Offset:</label>
    <input type="range" id="offset" name="offset" min="-0.3" max="0.3" step="0.01" value="0.0"><br><br>

    <button type="submit">Generate PDF</button>
  </form>

  <h2>Preview (Dummy)</h2>
  <div id="preview" class="preview" style="width:177px; height:150px;">
    <div id="face" class="face"></div>
    <div class="grid-line h" style="top: 33%;"></div>
    <div class="grid-line h" style="top: 66%;"></div>
    <div class="grid-line v" style="left: 33%;"></div>
    <div class="grid-line v" style="left: 66%;"></div>
  </div>

  <script>
    const preview = document.getElementById("preview");
    const face = document.getElementById("face");
    const widthInput = document.getElementById("width_in");
    const heightInput = document.getElementById("height_in");
    const faceRatioInput = document.getElementById("face_ratio");
    const offsetInput = document.getElementById("offset");

    function updatePreview() {
      let w = parseFloat(widthInput.value) * 100;
      let h = parseFloat(heightInput.value) * 100;
      preview.style.width = w + "px";
      preview.style.height = h + "px";

      let faceRatio = parseFloat(faceRatioInput.value);
      let faceSize = h * faceRatio;
      face.style.width = faceSize + "px";
      face.style.height = faceSize + "px";

      let offset = parseFloat(offsetInput.value);
      let topPos = (h / 2 - faceSize / 2) + (offset * h);
      let leftPos = (w / 2 - faceSize / 2);
      face.style.top = topPos + "px";
      face.style.left = leftPos + "px";
    }

    widthInput.addEventListener("input", updatePreview);
    heightInput.addEventListener("input", updatePreview);
    faceRatioInput.addEventListener("input", updatePreview);
    offsetInput.addEventListener("input", updatePreview);

    updatePreview();

    document.getElementById("uploadForm").onsubmit = async (e) => {
      e.preventDefault();
      let formData = new FormData(e.target);

      let res = await fetch("http://127.0.0.1:5000/remove", {
        method: "POST",
        body: formData
      });

      let blob = await res.blob();
      let link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "id_photos.pdf";
      link.click();
    };
  </script>
</body>
</html>
